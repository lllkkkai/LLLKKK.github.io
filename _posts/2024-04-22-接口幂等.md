---
layout: post
category: Design
---

# 幂等
同一个接口，多次发出一个请求，保证操作只执行一次

# 实现方式
1. token机制：
   1. 客户端第一次请求获得token，服务器端得到token
   2. 第二次请求发送token，服务器端删除token，执行业务逻辑
   3. 第三次请求token不存在，服务器端报错
2. 基于MySQL的唯一索引
3. 状态位

## 1.token机制实现
适用于客户端向服务器发送网络请求的场景，如API接口、订单支付等。在客户端发起请求时，可以将请求参数中添加一个唯一Token标识符，并在服务端做校验，只有当Token唯一且在有效期内才能继续执行请求，否则将被视为重复操作或者过期操作，返回相应的提示信息。

## 2.使用唯一索引防止新增数据
利用MySQL的唯一索引机制，数据重复插入数据库会抛出异常，确保不出现脏数据

## 3.状态机
就是业务单据上面有个状态，状态在不同的情况下会发生变更，一般情况下存在有限状态机，这时候，如果状态机已经处于下一个状态，这时候来了一个上一个状态的变更，理论上是不能够变更的，这样的话，保证了有限状态机的幂等。注意：订单等单据类业务，存在很长的状态流转，一定要深刻理解状态机，对业务系统设计能力提高有很大帮助。


# 如何设计一个好接口
1. 单一性原则，在明确接口职责的条件下，尽量做到接口单一，即一个接口只做一件事，而非两件以上
2. 