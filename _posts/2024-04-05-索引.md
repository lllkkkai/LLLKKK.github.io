---
layout: post
category: Mysql
---

索引是对数据库表中一列或多列的值进行排序的一种结构，使用索引可快速访问数据库表中的特定信息

# 索引原理

索引的存储原理大致可以概括为一句话：**以空间换时间**。

一般来说索引本身也很大，不可能全部存储在内存中，因此`索引往往是存储在磁盘上的文件中的`（可能存储在单独的索引文件中，也可能和数据一起存储在数据文件中）。

数据库在未添加索引进行查询的时候默认是进行全文搜索，也就是说有多少数据就进行多少次查询，然后找到相应的数据就把它们放到结果集中，直到全文扫描完毕。

# 索引分类

* 主键索引 
  设定为主键后，数据库自动建立索引，InnoDB为聚簇索引，主键索引列值不能为空（Null）。
* 唯一索引
* 复合索引
* 全文索引
* 空间索引
* 前缀索引

# 优缺点

**优点：**

* 大大提高数据查询速度。
* 可以提高数据检索的效率，降低数据库的IO成本，类似于书的目录。
* 通过索引列对数据进行排序，降低数据的排序成本降低了CPU的消耗。
* 被索引的列会自动进行排序，包括【单例索引】和【组合索引】，只是组合索引的排序需要复杂一些。
* 如果按照索引列的顺序进行排序，对order 不用语句来说，效率就会提高很多。

**缺点：**

* 索引会占据磁盘空间。
* 索引虽然会提高查询效率，但是会降低更新表的效率。比如每次对表进行增删改查操作，MySQL不仅要保存数据，还有保存或者更新对应的索引文件。
* 维护索引需要消耗数据库资源。

**综合索引的优缺点：**

* `数据库表中不是索引越多越好，而是仅为那些常用的搜索字段建立索引效果最佳!`

# 索引的数据结构

## Hash表

Hash表，在Java中的HashMap，TreeMap就是Hash表结构，以键值对的方式存储数据。我们使用Hash表存储表数据Key可以存储索引列，Value可以存储行记录或者行磁盘地址。Hash表在等值查询时效率很高，时间复杂度为O(1)；但是不支持范围快速查找，范围查找时还是只能通过扫描全表方式。

**显然这种并不适合作为经常需要查找和范围查找的数据库索引使用。**

## B树

B树的进化史：二叉查找树->平衡二叉树->B树（多叉平衡二叉树）

MySQL的数据是存储在磁盘文件中的，查询处理数据时，需要先把磁盘中的数据加载到内存中，磁盘IO 操作非常耗时，所以我们优化的重点就是==尽量减少磁盘 IO 操作==。访问二叉树的每个节点就会发生一次IO，如果想要减少磁盘IO操作，就需要尽量降低树的高度。那如何降低树的高度呢？

举个例子，在b树中查询数据的情况：
假如我们查询值等于10的数据。查询路径磁盘块1-\>磁盘块2-\>磁盘块5。

1. 第一次磁盘IO：将磁盘块1加载到内存中，在内存中从头遍历比较，10\<15，走左路，到磁盘寻址磁盘块2。
2. 第二次磁盘IO：将磁盘块2加载到内存中，在内存中从头遍历比较，7\<10，到磁盘中寻址定位到磁盘块5。
3. 第三次磁盘IO：将磁盘块5加载到内存中，在内存中从头遍历比较，10\=10，找到10，取出data，如果data存储的行记录，取出data，查询结束。如果存储的是磁盘地址，还需要根据磁盘地址到磁盘中取出数据，查询终止。
4. 相比二叉平衡查找树，在整个查找过程中，虽然数据的比较次数并没有明显减少，但是磁盘IO次数会大大减少。同时，由于我们的比较是在内存中进行的，比较的耗时可以忽略不计。B树的高度一般2至3层就能满足大部分的应用场景，所以使用B树构建索引可以很好的提升查询的效率。